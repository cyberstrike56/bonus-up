<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Бонусная программа</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <link rel="manifest" href="/manifest.json">
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4 max-w-md">
        <!-- Навигация -->
        <div class="text-center mb-4">
            <div class="flex justify-around">
                <button onclick="showClientInterface()" class="bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600">Клиент</button>
                <button onclick="showAdminLogin()" class="bg-green-500 text-white p-2 rounded-lg hover:bg-green-600">Админ</button>
            </div>
        </div>

        <!-- Клиентский интерфейс -->
        <div id="clientInterface" class="hidden">
            <h1 class="text-2xl font-bold text-center mb-4">Клиентская программа</h1>
            <div id="loginForm" class="mb-4">
                <input id="userInput" type="text" placeholder="Введите номер телефона (например, +71234567890 или 81234567890)" class="w-full p-2 border rounded-lg mb-2 focus:outline-none">
                <input id="firstNameInput" type="text" placeholder="Введите имя" class="w-full p-2 border rounded-lg mb-2 focus:outline-none hidden" data-registration-only>
                <input id="lastNameInput" type="text" placeholder="Введите фамилию" class="w-full p-2 border rounded-lg mb-2 focus:outline-none hidden" data-registration-only>
                <input id="birthDateInput" type="date" placeholder="Дата рождения" class="w-full p-2 border rounded-lg mb-2 focus:outline-none hidden" data-registration-only>
                <button onclick="registerUser()" class="w-full bg-blue-500 text-white p-2 rounded-lg mt-2 hover:bg-blue-600">Зарегистрироваться</button>
                <button onclick="loginUser()" class="w-full bg-gray-500 text-white p-2 rounded-lg mt-2 hover:bg-gray-600">Войти</button>
            </div>
            <div id="userInfo" class="hidden mb-4 p-4 bg-white rounded-lg shadow">
                <p id="welcomeMessage" class="text-center mb-2"></p>
                <p><strong>Имя:</strong> <span id="displayFirstName"></span></p>
                <p><strong>Фамилия:</strong> <span id="displayLastName"></span></p>
                <p><strong>Идентификатор:</strong> <span id="displayIdentifier"></span> (<span id="displayType">Телефон</span>)</p>
                <p><strong>Бонусы:</strong> <span id="displayPoints"></span></p>
                <button onclick="openReview()" class="w-full bg-yellow-500 text-white p-2 rounded-lg mt-4 hover:bg-yellow-600">Оставить отзыв</button>
            </div>
            <div id="qrCodeContainer" class="flex justify-center mt-4"></div>
            <p id="qrMessage" class="text-center mt-2"></p>
        </div>

        <!-- Админский интерфейс: Вход -->
        <div id="adminLogin" class="hidden">
            <h1 class="text-2xl font-bold text-center mb-4">Вход для администратора</h1>
            <div class="mb-4">
                <input id="adminPhoneInput" type="text" placeholder="Введите номер телефона (например, +71234567890 или 81234567890)" class="w-full p-2 border rounded-lg mb-2 focus:outline-none">
                <button onclick="adminLogin()" class="w-full bg-green-500 text-white p-2 rounded-lg mt-2 hover:bg-green-600">Войти</button>
            </div>
            <p id="adminLoginMessage" class="text-center mt-2"></p>
        </div>

        <!-- Админский интерфейс: Сканер и статистика -->
        <div id="adminScanner" class="hidden">
            <h1 class="text-2xl font-bold text-center mb-4">Сканер QR-кода и статистика</h1>
            <div class="mb-4 p-4 bg-white rounded-lg shadow">
                <p id="adminWelcomeMessage" class="text-center mb-2"></p>
                <p><strong>Администратор:</strong> <span id="adminPhone"></span></p>
                <p><strong>Начислено бонусов:</strong> <span id="adminPointsAdded">0</span></p>
                <p><strong>Списано бонусов:</strong> <span id="adminPointsDeducted">0</span></p>
            </div>
            <div class="flex justify-around mb-4 flex-wrap">
                <select id="scanAction" class="w-full p-2 border rounded-lg focus:outline-none mb-2">
                    <option value="add">Начислить бонусы</option>
                    <option value="deduct">Списать бонусы</option>
                </select>
                <button onclick="showClientList()" class="bg-yellow-500 text-white p-2 rounded-lg hover:bg-yellow-600 w-full mx-1 mb-2">Показать базу клиентов</button>
                <a href="https://wa.me/1234567890" target="_blank" class="bg-green-600 text-white p-2 rounded-lg hover:bg-green-700 text-center w-full mx-1 mb-2">WhatsApp</a>
                <button onclick="toggleScanner()" class="bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 w-full mx-1 mb-2">Открыть/Закрыть сканер</button>
                <button onclick="showSales('tir')" class="bg-purple-500 text-white p-2 rounded-lg hover:bg-purple-600 w-full mx-1 mb-2">Тир</button>
                <button onclick="showSales('arcade')" class="bg-purple-500 text-white p-2 rounded-lg hover:bg-purple-600 w-full mx-1 mb-2">Аркада</button>
                <button onclick="showSales('viar')" class="bg-purple-500 text-white p-2 rounded-lg hover:bg-purple-600 w-full mx-1 mb-2">ВИАР</button>
                <button id="shiftButton" onclick="showShiftInfo()" class="bg-orange-500 text-white p-2 rounded-lg hover:bg-orange-600 w-full mx-1 mb-2 hidden">Смена</button>
            </div>
            <div id="qrScanner" class="w-full h-64 bg-gray-200 rounded-lg hidden"></div>
            <p id="scanResult" class="text-center mt-4"></p>
            <div id="salesForm" class="hidden mt-4 p-4 bg-white rounded-lg shadow">
                <h2 id="salesTitle" class="text-xl font-bold mb-2"></h2>
                <div id="salesInputs"></div>
                <button onclick="saveSales()" class="bg-green-500 text-white p-2 rounded-lg mt-2 hover:bg-green-600">Сохранить</button>
                <p id="salesSummary" class="mt-2"></p>
            </div>
            <div id="shiftInfo" class="hidden mt-4 p-4 bg-white rounded-lg shadow">
                <h2 class="text-xl font-bold mb-2">Информация о смене</h2>
                <div id="shiftEmployees"></div>
                <button onclick="addEmployee()" class="bg-blue-500 text-white p-2 rounded-lg mt-2 hover:bg-blue-600">Добавить сотрудника</button>
            </div>
            <div id="clientList" class="hidden mt-4 p-4 bg-white rounded-lg shadow">
                <h2 class="text-xl font-bold mb-2">База клиентов</h2>
                <ul id="clientListItems"></ul>
            </div>
        </div>
    </div>

    <script>
        // Предотвращение закрытия страницы при нажатии "назад" или свайпе
        window.onpopstate = function(event) {
            location.reload();
        };

        // Функция для получения времени в Оренбурге (UTC+5)
        function getOrenburgTime() {
            const now = new Date();
            const offset = 5; // UTC+5 для Оренбурга
            const localTime = new Date(now.getTime() + (offset * 60 * 60 * 1000));
            return localTime.toLocaleString('ru-RU', { hour: '2-digit', minute: '2-digit', hour12: false });
        }

        // Открытие ссылки для отзыва
        function openReview() {
            window.open('https://yandex.ru/maps/org/game_zone/52624971299/reviews/?add-review=true&ll=55.223838%2C51.808670&mode=search&sll=55.157921%2C51.808632&source=serp_navig&tab=reviews&text=%D1%8F%D0%BD%D0%B4%D0%B5%D0%BA%D1%81%20gamezone%20%D0%BE%D1%80%D0%B5%D0%BD%D0%B1%D1%83%D1%80%D0%B3&z=12', '_blank');
        }

        // Инициализация списка администраторов
        function initializeAdmins() {
            const admins = [
                { phone: '+71234567890', pointsAdded: 0, pointsDeducted: 0 },
                { phone: '+70987654321', pointsAdded: 0, pointsDeducted: 0 },
                { phone: '+79776632788', pointsAdded: 0, pointsDeducted: 0 },
                { phone: '+79878808777', pointsAdded: 0, pointsDeducted: 0 }
            ];
            if (!localStorage.getItem('admins')) {
                localStorage.setItem('admins', JSON.stringify(admins));
            }
        }

        // Проверка, является ли номер администраторским
        function isAdmin(phone) {
            const admins = JSON.parse(localStorage.getItem('admins')) || [];
            return admins.some(admin => normalizePhone(admin.phone) === normalizePhone(phone));
        }

        // Нормализация номера телефона (удаление лишних символов и приведение к +7)
        function normalizePhone(phone) {
            return phone.replace(/[^\d]/g, '').replace(/^8/, '+7');
        }

        // Обновление статистики администратора
        function updateAdminStats(phone, pointsAdded = 0, pointsDeducted = 0) {
            const admins = JSON.parse(localStorage.getItem('admins')) || [];
            const admin = admins.find(a => a.phone === normalizePhone(phone));
            if (admin) {
                admin.pointsAdded += pointsAdded;
                admin.pointsDeducted += pointsDeducted;
                localStorage.setItem('admins', JSON.stringify(admins));
            }
            return admin;
        }

        // Генерация UUID для уникального ID пользователя
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Сохранение пользователя в localStorage с датой
        function saveUser(identifier, type, firstName, lastName, birthDate, userId, points = 0) {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const registrationDate = new Date().toLocaleString('ru-RU', { day: '2-digit', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'UTC' + 5 });
            users.push({ identifier, type, firstName, lastName, birthDate, userId, points, registrationDate });
            localStorage.setItem('users', JSON.stringify(users));
        }

        // Обновление бонусов пользователя
        function updateUserPoints(userId, pointsChange, isAdd) {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(u => u.userId === userId);
            if (user) {
                if (isAdd) {
                    user.points = (user.points || 0) + pointsChange;
                } else {
                    if ((user.points || 0) < pointsChange) {
                        return null; // Недостаточно бонусов
                    }
                    user.points = (user.points || 0) - pointsChange;
                }
                localStorage.setItem('users', JSON.stringify(users));
            }
            return user;
        }

        // Поиск пользователя по идентификатору (phone)
        function findUserByIdentifier(identifier, type) {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            return users.find(user => normalizePhone(user.identifier) === normalizePhone(identifier) && user.type === type);
        }

        // Поиск пользователя по userId
        function findUserById(userId) {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            return users.find(user => user.userId === userId);
        }

        // Валидация номера телефона (для России: +7 или 8 и 10 цифр)
        function isValidPhone(phone) {
            return /^(\+?7|8)[0-9]{10}$/.test(phone.replace(/[^\d]/g, ''));
        }

        // Валидация имени и фамилии
        function isValidName(name) {
            return name.trim().length > 0;
        }

        // Валидация даты рождения (старше 14 лет на 05.08.2025)
        function isValidBirthDate(birthDate) {
            const date = new Date(birthDate);
            const today = new Date('2025-08-05');
            const age = today.getFullYear() - date.getFullYear();
            const monthDiff = today.getMonth() - date.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < date.getDate())) {
                age--;
            }
            return !isNaN(date) && date <= today && age >= 14;
        }

        // Показать/скрыть поля регистрации
        function toggleRegistrationFields(show) {
            const fields = document.querySelectorAll('[data-registration-only]');
            fields.forEach(field => {
                field.classList.toggle('hidden', !show);
            });
        }

        // Отобразить информацию о пользователе
        function displayUserInfo(user) {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('displayFirstName').textContent = user.firstName;
            document.getElementById('displayLastName').textContent = user.lastName;
            document.getElementById('displayIdentifier').textContent = user.identifier;
            document.getElementById('displayType').textContent = user.type === 'phone' ? 'Телефон' : 'Телефон';
            document.getElementById('displayPoints').textContent = user.points || 0;
            // Обновление приветствия с текущей датой и временем в Оренбурге
            const welcomeMessage = document.getElementById('welcomeMessage');
            welcomeMessage.textContent = `Привет, ${user.firstName}! Сегодня среда, 06 августа 2025 года, ${getOrenburgTime()} ORE.`;
        }

        // Регистрация пользователя
        function registerUser() {
            const userInput = document.getElementById('userInput').value.trim();
            const firstNameInput = document.getElementById('firstNameInput').value.trim();
            const lastNameInput = document.getElementById('lastNameInput').value.trim();
            const birthDateInput = document.getElementById('birthDateInput').value;
            const qrCodeContainer = document.getElementById('qrCodeContainer');
            const qrMessage = document.getElementById('qrMessage');

            // Показать поля регистрации
            toggleRegistrationFields(true);

            // Валидация
            if (!isValidPhone(userInput)) {
                qrMessage.textContent = 'Пожалуйста, введите корректный номер телефона (например, +71234567890 или 81234567890).';
                return;
            }
            if (!isValidName(firstNameInput)) {
                qrMessage.textContent = 'Пожалуйста, введите корректное имя.';
                return;
            }
            if (!isValidName(lastNameInput)) {
                qrMessage.textContent = 'Пожалуйста, введите корректную фамилию.';
                return;
            }
            if (!isValidBirthDate(birthDateInput)) {
                qrMessage.textContent = 'Пожалуйста, введите корректную дату рождения (возраст должен быть 14+).';
                return;
            }

            // Проверка, не зарегистрирован ли уже пользователь
            if (findUserByIdentifier(userInput, 'phone')) {
                qrMessage.textContent = 'Этот номер телефона уже зарегистрирован.';
                return;
            }

            const userId = generateUUID();
            saveUser(userInput, 'phone', firstNameInput, lastNameInput, birthDateInput, userId);

            const user = findUserByIdentifier(userInput, 'phone');
            qrCodeContainer.innerHTML = '';
            new QRCode(qrCodeContainer, {
                text: userId,
                width: 200,
                height: 200
            });

            qrMessage.textContent = 'Ваш QR-код для накопления бонусов готов!';
            displayUserInfo(user);
            document.getElementById('userInput').value = '';
            document.getElementById('firstNameInput').value = '';
            document.getElementById('lastNameInput').value = '';
            document.getElementById('birthDateInput').value = '';
            toggleRegistrationFields(false);
        }

        // Вход пользователя
        function loginUser() {
            const userInput = document.getElementById('userInput').value.trim();
            const qrCodeContainer = document.getElementById('qrCodeContainer');
            const qrMessage = document.getElementById('qrMessage');

            // Скрыть поля регистрации при входе
            toggleRegistrationFields(false);

            if (!isValidPhone(userInput)) {
                qrMessage.textContent = 'Пожалуйста, введите корректный номер телефона (например, +71234567890 или 81234567890).';
                return;
            }

            const user = findUserByIdentifier(userInput, 'phone');
            if (!user) {
                qrMessage.textContent = 'Пользователь с таким номером телефона не найден.';
                return;
            }

            qrCodeContainer.innerHTML = '';
            new QRCode(qrCodeContainer, {
                text: user.userId,
                width: 200,
                height: 200
            });

            qrMessage.textContent = 'Ваш QR-код восстановлен!';
            displayUserInfo(user);
            document.getElementById('userInput').value = '';
        }

        // Вход администратора
        function adminLogin() {
            const phoneInput = document.getElementById('adminPhoneInput').value.trim();
            const loginMessage = document.getElementById('adminLoginMessage');

            if (!isValidPhone(phoneInput)) {
                loginMessage.textContent = 'Пожалуйста, введите корректный номер телефона (например, +71234567890 или 81234567890).';
                return;
            }

            if (!isAdmin(phoneInput)) {
                loginMessage.textContent = 'Доступ запрещен: номер телефона не зарегистрирован как администраторский.';
                return;
            }

            document.getElementById('adminLogin').classList.add('hidden');
            document.getElementById('adminScanner').classList.remove('hidden');
            const admin = updateAdminStats(phoneInput); // Загрузить статистику
            document.getElementById('adminPhone').textContent = phoneInput;
            document.getElementById('adminPointsAdded').textContent = admin.pointsAdded || 0;
            document.getElementById('adminPointsDeducted').textContent = admin.pointsDeducted || 0;
            // Обновление приветствия с текущей датой и временем в Оренбурге
            const adminWelcomeMessage = document.getElementById('adminWelcomeMessage');
            adminWelcomeMessage.textContent = `Привет, администратор! Сегодня среда, 06 августа 2025 года, ${getOrenburgTime()} ORE.`;
            // Показать кнопку "Смена" только для +79878808777
            const shiftButton = document.getElementById('shiftButton');
            if (normalizePhone(phoneInput) === '+79878808777') {
                shiftButton.classList.remove('hidden');
            } else {
                shiftButton.classList.add('hidden');
            }
            loginMessage.textContent = '';
            document.getElementById('adminPhoneInput').value = '';
            // Обнуление продаж в воскресенье в 00:00 (по ORE)
            checkResetSales();
        }

        // Показать список клиентов
        function showClientList() {
            const clientList = document.getElementById('clientList');
            const clientListItems = document.getElementById('clientListItems');
            clientListItems.innerHTML = ''; // Очистка списка
            const users = JSON.parse(localStorage.getItem('users')) || [];
            if (users.length === 0) {
                clientListItems.innerHTML = '<li class="text-center">Нет зарегистрированных клиентов.</li>';
            } else {
                users.forEach(user => {
                    const li = document.createElement('li');
                    li.className = 'mb-2';
                    li.innerHTML = `<strong>${user.firstName} ${user.lastName}</strong> (ID: ${user.userId}, Тип: Телефон, Последняя регистрация: ${user.registrationDate})`;
                    clientListItems.appendChild(li);
                });
            }
            clientList.classList.remove('hidden');
        }

        // Показать клиентский интерфейс
        function showClientInterface() {
            document.getElementById('clientInterface').classList.remove('hidden');
            document.getElementById('adminLogin').classList.add('hidden');
            document.getElementById('adminScanner').classList.add('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('qrCodeContainer').innerHTML = '';
            document.getElementById('qrMessage').textContent = '';
            stopScanner();
            toggleRegistrationFields(false);
        }

        // Показать экран входа администратора
        function showAdminLogin() {
            document.getElementById('clientInterface').classList.add('hidden');
            document.getElementById('adminLogin').classList.remove('hidden');
            document.getElementById('adminScanner').classList.add('hidden');
            document.getElementById('scanResult').textContent = '';
            stopScanner();
            document.getElementById('clientList').classList.add('hidden'); // Скрыть список при выходе
            document.getElementById('qrScanner').classList.add('hidden'); // Убедимся, что сканер скрыт
            document.getElementById('salesForm').classList.add('hidden');
            document.getElementById('shiftInfo').classList.add('hidden');
        }

        // Переключение сканера
        function toggleScanner() {
            const scanner = document.getElementById('qrScanner');
            const isHidden = scanner.classList.contains('hidden');
            scanner.classList.toggle('hidden', !isHidden);
            if (isHidden) {
                startScanner();
            } else {
                stopScanner();
                document.getElementById('scanResult').textContent = '';
            }
        }

        // Инициализация сканера
        let html5QrcodeScanner = null;
        function startScanner() {
            const scanResult = document.getElementById('scanResult');
            const scanAction = document.getElementById('scanAction').value;
            const adminPhone = document.getElementById('adminPhone').textContent;
            scanResult.textContent = 'Наведите камеру на QR-код...';
            html5QrcodeScanner = new Html5Qrcode('qrScanner');
            html5QrcodeScanner.start(
                { facingMode: 'environment' },
                { fps: 10, qrbox: { width: 250, height: 250 } },
                (decodedText) => {
                    const isAdd = scanAction === 'add';
                    const user = updateUserPoints(decodedText, 10, isAdd);
                    if (user) {
                        updateAdminStats(adminPhone, isAdd ? 10 : 0, isAdd ? 0 : 10);
                        document.getElementById('adminPointsAdded').textContent = (parseInt(document.getElementById('adminPointsAdded').textContent) || 0) + (isAdd ? 10 : 0);
                        document.getElementById('adminPointsDeducted').textContent = (parseInt(document.getElementById('adminPointsDeducted').textContent) || 0) + (isAdd ? 0 : 10);
                        scanResult.textContent = `Сканування завершено. ${isAdd ? 'Начислено' : 'Списано'} 10 бонусів.`;
                    } else {
                        scanResult.textContent = 'Ошибка: недостаточно бонусов для списания.';
                    }
                    stopScanner();
                },
                (error) => {
                    scanResult.textContent = 'Ошибка сканирования: ' + error;
                }
            ).catch((err) => {
                scanResult.textContent = 'Ошибка инициализации сканера: ' + err;
            });
        }

        // Остановка сканера
        function stopScanner() {
            if (html5QrcodeScanner) {
                html5QrcodeScanner.stop().then(() => {
                    html5QrcodeScanner.clear();
                    html5QrcodeScanner = null;
                }).catch((err) => {
                    console.error('Ошибка остановки сканера:', err);
                });
            }
        }

        // Обнуление продаж в воскресенье в 00:00 (по ORE)
        function checkResetSales() {
            const now = new Date();
            const offset = 5; // UTC+5 для Оренбурга
            const localTime = new Date(now.getTime() + (offset * 60 * 60 * 1000));
            const day = localTime.getUTCDay();
            const hour = localTime.getUTCHours();
            if (day === 0 && hour === 0) { // Воскресенье, 00:00
                localStorage.removeItem('salesData');
                localStorage.removeItem('shiftData');
            }
        }

        // Показать форму продаж
        function showSales(type) {
            const salesForm = document.getElementById('salesForm');
            const salesTitle = document.getElementById('salesTitle');
            const salesInputs = document.getElementById('salesInputs');
            const salesSummary = document.getElementById('salesSummary');
            salesInputs.innerHTML = '';
            let items = [];

            if (type === 'tir') {
                salesTitle.textContent = 'Статистика Тира';
                items = [
                    { name: 'Акция дуэль', key: 'tir_duel' },
                    { name: 'Акция 1200', key: 'tir_1200' },
                    { name: 'Акция 3000', key: 'tir_3000' },
                    { name: 'Сертификат 999+1', key: 'tir_cert' }
                ];
            } else if (type === 'arcade') {
                salesTitle.textContent = 'Статистика Аркады';
                items = [
                    { name: 'Акция 2000', key: 'arcade_2000' },
                    { name: 'Акция 1200', key: 'arcade_1200' },
                    { name: 'Сертификат 999+1', key: 'arcade_cert' }
                ];
            } else if (type === 'viar') {
                salesTitle.textContent = 'Статистика ВИАР';
                items = [
                    { name: 'Акция 1800', key: 'viar_1800' },
                    { name: 'Сертификат 999+1', key: 'viar_cert' }
                ];
            }

            const salesData = JSON.parse(localStorage.getItem('salesData')) || {};
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'mb-2';
                const value = salesData[item.key] || { today: 0, week: 0 };
                div.innerHTML = `
                    <label class="block">${item.name}</label>
                    <input type="number" id="${item.key}_today" value="${value.today}" class="w-full p-2 border rounded-lg mb-1" placeholder="Сегодня">
                    <input type="number" id="${item.key}_week" value="${value.week}" class="w-full p-2 border rounded-lg mb-1" placeholder="Неделя">
                `;
                salesInputs.appendChild(div);
            });

            salesSummary.textContent = '';
            salesForm.classList.remove('hidden');
        }

        // Сохранение продаж
        function saveSales() {
            const salesData = JSON.parse(localStorage.getItem('salesData')) || {};
            const inputs = document.getElementById('salesInputs').getElementsByTagName('input');
            for (let input of inputs) {
                const [key, period] = input.id.split('_');
                if (!salesData[key]) salesData[key] = { today: 0, week: 0 };
                salesData[key][period] = parseInt(input.value) || 0;
            }
            localStorage.setItem('salesData', JSON.stringify(salesData));
            const salesSummary = document.getElementById('salesSummary');
            salesSummary.textContent = 'Данные сохранены!';
            setTimeout(() => {
                salesSummary.textContent = '';
                document.getElementById('salesForm').classList.add('hidden');
            }, 2000);
        }

        // Показать информацию о смене
        function showShiftInfo() {
            const shiftInfo = document.getElementById('shiftInfo');
            const shiftEmployees = document.getElementById('shiftEmployees');
            shiftEmployees.innerHTML = '';
            const shiftData = JSON.parse(localStorage.getItem('shiftData')) || [];
            if (shiftData.length === 0) {
                shiftEmployees.innerHTML = '<p class="text-center">Нет данных о сотрудниках.</p>';
            } else {
                shiftData.forEach(emp => {
                    const div = document.createElement('div');
                    div.className = 'mb-2';
                    div.innerHTML = `<p><strong>${emp.name}</strong> - Продано сертификатов: ${emp.certificates}</p>`;
                    shiftEmployees.appendChild(div);
                });
            }
            shiftInfo.classList.remove('hidden');
        }

        // Добавить сотрудника
        function addEmployee() {
            const name = prompt('Введите имя сотрудника:');
            if (name) {
                const certificates = parseInt(prompt('Введите количество проданных сертификатов:') || 0);
                const shiftData = JSON.parse(localStorage.getItem('shiftData')) || [];
                shiftData.push({ name, certificates });
                localStorage.setItem('shiftData', JSON.stringify(shiftData));
                showShiftInfo();
            }
        }